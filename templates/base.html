<!DOCTYPE html>
<html lang="en" data-theme="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="PRAMMS - Property Rental and Maintenance Management System - Simplify your property management">
    <title>{% block title %}PRAMMS{% endblock %}</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Custom Styles -->
    <link rel="stylesheet" href="/static/css/style.css">

    {% block extra_css %}{% endblock %}
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container navbar-content">
            <a href="{% url 'home' %}" class="navbar-brand">
                <span class="logo-icon">P</span>
                PRAMMS
            </a>

            <!-- Role indicator (centered) -->
            {% if user.is_authenticated %}
            <div class="navbar-center">
                {% if user.is_landlord %}
                <span class="role-indicator landlord">Landlord Profile</span>
                {% elif user.is_tenant %}
                <span class="role-indicator tenant">Tenant Profile</span>
                {% endif %}
            </div>
            {% endif %}

            <ul class="navbar-nav">
                {% if user.is_authenticated %}
                <!-- Navigation links -->
                <li><a href="{% url 'dashboard' %}"
                        class="{% if request.resolver_match.url_name == 'dashboard' or 'dashboard' in request.path %}active{% endif %}">Dashboard</a>
                </li>
                {% if user.is_landlord %}
                <li><a href="{% url 'property_list' %}"
                        class="{% if 'properties' in request.path %}active{% endif %}">Properties</a></li>
                {% endif %}
                <li class="nav-item-badge">
                    <a href="{% url 'maintenance_list' %}"
                        class="{% if 'maintenance' in request.path %}active{% endif %}">
                        Requests
                    </a>
                    {% if unread_maintenance_count > 0 %}
                    <span class="notification-badge">{{ unread_maintenance_count }}</span>
                    {% endif %}
                </li>

                <!-- User Profile Dropdown -->
                <li class="user-dropdown">
                    <button class="user-dropdown-btn" onclick="toggleUserMenu()">
                        {% if user.has_profile_picture %}
                        <img src="{{ user.profile_picture.url }}" alt="Profile" class="user-avatar-img">
                        {% else %}
                        <div class="user-avatar">
                            {{ user.first_name|slice:":1"|upper }}{{ user.last_name|slice:":1"|upper }}
                        </div>
                        {% endif %}
                        <span class="user-name">{{ user.first_name }}</span>
                        <svg class="dropdown-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2">
                            <polyline points="6,9 12,15 18,9"></polyline>
                        </svg>
                    </button>
                    <div class="user-menu" id="userMenu">
                        <div class="user-menu-header">
                            {% if user.has_profile_picture %}
                            <img src="{{ user.profile_picture.url }}" alt="Profile" class="user-avatar-img large">
                            {% else %}
                            <div class="user-avatar large">
                                {{ user.first_name|slice:":1"|upper }}{{ user.last_name|slice:":1"|upper }}
                            </div>
                            {% endif %}
                            <div>
                                <p class="user-menu-name">{{ user.get_full_name|default:user.username }}</p>
                                <p class="user-menu-email">{{ user.email }}</p>
                            </div>
                        </div>
                        <div class="user-menu-divider"></div>
                        <a href="{% url 'my_account' %}" class="user-menu-item">
                            <svg class="menu-icon-svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="1.5">
                                <circle cx="12" cy="8" r="4"></circle>
                                <path d="M6 21v-2a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v2"></path>
                            </svg>
                            My Account
                        </a>
                        <a href="#" class="user-menu-item">
                            <svg class="menu-icon-svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="1.5">
                                <circle cx="12" cy="12" r="3"></circle>
                                <path
                                    d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
                                </path>
                            </svg>
                            Settings
                        </a>
                        <div class="user-menu-item theme-toggle" onclick="toggleTheme(event)">
                            <svg class="menu-icon-svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="1.5">
                                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                            </svg>
                            <span>Dark Mode</span>
                            <label class="switch">
                                <input type="checkbox" id="themeSwitch">
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="user-menu-divider"></div>
                        <form method="post" action="{% url 'logout' %}" style="margin: 0;">
                            {% csrf_token %}
                            <button type="submit" class="user-menu-item signout">
                                <svg class="menu-icon-svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                                    stroke="currentColor" stroke-width="1.5">
                                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                                    <polyline points="16 17 21 12 16 7"></polyline>
                                    <line x1="21" y1="12" x2="9" y2="12"></line>
                                </svg>
                                Sign Out
                            </button>
                        </form>
                    </div>
                </li>
                {% else %}
                <li><a href="{% url 'login' %}" class="{% if 'login' in request.path %}active{% endif %}">Login</a></li>
                <li><a href="{% url 'register' %}" class="btn-accent">Register as Landlord</a></li>
                {% endif %}
            </ul>
        </div>
    </nav>

    <!-- Messages -->
    {% if messages %}
    <div class="messages">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Main Content -->
    <main>
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    {% block footer %}
    <footer class="footer">
        <div class="container">
            <p>&copy; 2026 PRAMMS - Property Rental and Maintenance Management System</p>
        </div>
    </footer>
    {% endblock %}

    {% block extra_js %}{% endblock %}

    <script>
        // Auto-dismiss alerts after 5 seconds
        setTimeout(() => {
            const alerts = document.querySelectorAll('.alert');
            alerts.forEach(alert => {
                alert.style.animation = 'slideIn 0.3s ease reverse';
                setTimeout(() => alert.remove(), 300);
            });
        }, 5000);

        // User dropdown menu
        function toggleUserMenu() {
            const menu = document.getElementById('userMenu');
            menu.classList.toggle('show');
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function (e) {
            const dropdown = document.querySelector('.user-dropdown');
            if (dropdown && !dropdown.contains(e.target)) {
                document.getElementById('userMenu').classList.remove('show');
            }
        });

        // Theme toggle
        function toggleTheme(e) {
            e.preventDefault();
            e.stopPropagation();
            const html = document.documentElement;
            const themeSwitch = document.getElementById('themeSwitch');
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', newTheme);
            themeSwitch.checked = newTheme === 'dark';
            localStorage.setItem('theme', newTheme);
        }

        // Load saved theme
        (function () {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            const themeSwitch = document.getElementById('themeSwitch');
            if (themeSwitch) themeSwitch.checked = savedTheme === 'dark';
        })();
    </script>
</body>

</html>