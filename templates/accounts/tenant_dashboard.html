{% extends 'base.html' %}

{% block title %}My Dashboard - PRAMMS{% endblock %}

{% block content %}
<div class="dashboard container">
    <div class="dashboard-header">
        <div>
            <h1>Welcome, {{ user.username }}!</h1>
            <p style="color: var(--gray-500);">View your property details and maintenance requests.</p>
        </div>
        <div class="actions">
            <a href="{% url 'maintenance_create' %}" class="btn btn-primary">+ New Request</a>
        </div>
    </div>

    <!-- Property Info -->
    {% if property %}
    <div class="card mb-4">
        <div class="card-header">
            <h3 class="card-title">Your Property</h3>
            <span class="badge badge-success">Active Lease</span>
        </div>
        <div class="card-body">
            <h4 style="margin-bottom: 0.5rem;">{{ property.name }}</h4>
            <p style="color: var(--gray-500); margin-bottom: 1rem;">{{ property.address }}</p>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-top: 1.5rem;">
                <div>
                    <p style="color: var(--gray-500); font-size: 0.875rem;">Rent ({{ property.get_rent_period_display }})</p>
                    <p style="font-size: 1.5rem; font-weight: 600; color: var(--accent);">{{ property.formatted_rent }}</p>
                </div>
                <div>
                    <p style="color: var(--gray-500); font-size: 0.875rem;">Lease Start Date</p>
                    <p style="font-size: 1.25rem; font-weight: 500;">{{ tenant_profile.move_in_date|date:"M d, Y" }}</p>
                </div>
                <div>
                    <p style="color: var(--gray-500); font-size: 0.875rem;">Lease End Date</p>
                    <p style="font-size: 1.25rem; font-weight: 500; color: var(--warning);">{{ tenant_profile.lease_end_date|date:"M d, Y" }}</p>
                </div>
                <div>
                    <p style="color: var(--gray-500); font-size: 0.875rem;">Landlord</p>
                    <p style="font-size: 1.25rem; font-weight: 500;">{{ tenant_profile.landlord.get_full_name }}</p>
                </div>
            </div>
        </div>
    </div>
    {% else %}
    <div class="alert alert-warning" style="position: static; margin-bottom: 1.5rem;">
        You are not currently assigned to a property. Please contact your landlord.
    </div>
    {% endif %}

    <!-- Maintenance Requests -->
    <h2 class="section-title">Recent Maintenance Requests</h2>

    {% if maintenance_requests %}
    <div class="request-list">
        {% for request in maintenance_requests|slice:":5" %}
        <a href="{% url 'maintenance_detail' request.pk %}" class="request-item">
            <div class="request-priority {{ request.priority }}"></div>
            <div class="request-content">
                <h4>{{ request.title }}</h4>
                <p>{{ request.description|truncatechars:60 }}</p>
            </div>
            <div class="request-meta">
                <span class="badge badge-{% if request.status == 'pending' %}warning{% elif request.status == 'completed' %}success{% else %}info{% endif %}">{{ request.get_status_display }}</span>
                <p class="mt-1">{{ request.created_at|timesince }} ago</p>
            </div>
        </a>
        {% endfor %}
    </div>
    <a href="{% url 'maintenance_list' %}" class="btn btn-outline mt-2">View All Requests</a>
    {% else %}
    <div class="empty-state card">
        <div class="empty-state-icon">ðŸ”§</div>
        <h3>No Maintenance Requests</h3>
        <p>Need something fixed? Submit a maintenance request.</p>
        <a href="{% url 'maintenance_create' %}" class="btn btn-primary mt-2">+ New Request</a>
    </div>
    {% endif %}
</div>
{% endblock %}
