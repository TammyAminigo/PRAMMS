{% extends 'base.html' %}

{% block title %}New Maintenance Request - Propz{% endblock %}

{% block content %}
<div class="auth-container">
    <div class="auth-card" style="max-width: 560px;">
        <h2>New Maintenance Request</h2>
        <p class="subtitle">Report an issue at {{ property.name }}</p>

        <form method="post" enctype="multipart/form-data" novalidate>
            {% csrf_token %}

            <div class="form-group">
                <label class="form-label" for="id_title">Issue Title</label>
                {{ form.title }}
                {% if form.title.errors %}
                <p class="form-error">{{ form.title.errors.0 }}</p>
                {% endif %}
                <p class="form-help">Brief description of the issue (e.g., "Leaking faucet in bathroom")</p>
            </div>

            <div class="form-group">
                <label class="form-label" for="id_description">Description</label>
                {{ form.description }}
                {% if form.description.errors %}
                <p class="form-error">{{ form.description.errors.0 }}</p>
                {% endif %}
                <p class="form-help">Provide as much detail as possible about the issue</p>
            </div>

            <div class="form-group">
                <label class="form-label" for="id_priority">Priority Level</label>
                {{ form.priority }}
                <p class="form-help">
                    <strong>Low:</strong> Cosmetic issues<br>
                    <strong>Medium:</strong> Needs attention soon<br>
                    <strong>High:</strong> Affects daily living<br>
                    <strong>Emergency:</strong> Safety hazard or flooding
                </p>
            </div>

            <div class="form-group">
                <label class="form-label">Photos <span style="color: var(--danger-color, #dc3545);">*</span> <span style="font-weight: normal; font-size: 0.85em; color: var(--gray-500);">(1-3 required)</span></label>
                <input type="file" name="images" id="id_images" class="form-input" accept="image/*" multiple required>
                <p class="form-help">Upload at least 1 photo (max 3) to help explain the issue</p>
                <p id="photo-error" class="form-error" style="display: none;">At least one photo is required.</p>
            </div>

            <div style="display: flex; gap: 1rem;">
                <button type="submit" class="btn btn-primary" style="flex: 1;">Submit Request</button>
                <a href="{% url 'tenant_dashboard' %}" class="btn btn-outline" style="flex: 1;">Cancel</a>
            </div>
        </form>
    </div>
</div>

<script>
document.querySelector('form').addEventListener('submit', function(e) {
    const fileInput = document.getElementById('id_images');
    const errorEl = document.getElementById('photo-error');
    
    if (!fileInput.files || fileInput.files.length === 0) {
        e.preventDefault();
        errorEl.style.display = 'block';
        fileInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
        return false;
    }
    
    if (fileInput.files.length > 3) {
        e.preventDefault();
        errorEl.textContent = 'Maximum 3 photos allowed.';
        errorEl.style.display = 'block';
        fileInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
        return false;
    }
    
    errorEl.style.display = 'none';
});

document.getElementById('id_images').addEventListener('change', function() {
    document.getElementById('photo-error').style.display = 'none';
});
</script>
{% endblock %}