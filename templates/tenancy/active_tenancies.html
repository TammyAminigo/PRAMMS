{% extends 'base.html' %}
{% load humanize %}

{% block title %}Active Tenancies - Propz{% endblock %}

{% block content %}
<section class="dashboard">
    <div class="container">
        <div class="dashboard-header">
            <h1>Active Tenancies</h1>
            <div class="actions">
                <a href="{% url 'past_tenancies' %}" class="btn btn-outline">View History</a>
                <a href="{% url 'dashboard' %}" class="btn btn-outline">&#8592; Dashboard</a>
            </div>
        </div>

        {% if tenancies %}
        <div class="property-grid">
            {% for tenancy in tenancies %}
            <a href="{% url 'tenancy_detail' pk=tenancy.pk %}" class="property-card"
                style="text-decoration: none; color: inherit;">
                <div class="property-card-image" style="height: 100px;">
                    <span class="placeholder-icon" style="font-size: 2.5rem;"><i data-lucide="key-round"
                            class="icon-md"></i></span>
                    <div style="position: absolute; top: 12px; right: 12px;">
                        {% if tenancy.status == 'active' %}
                        <span class="badge badge-success">Active</span>
                        {% elif tenancy.status == 'pending_termination' %}
                        <span class="badge badge-warning">Pending Termination</span>
                        {% endif %}
                    </div>
                </div>
                <div class="property-card-body">
                    <h4>{{ tenancy.rental_property.name }}</h4>
                    <p class="address"><i data-lucide="map-pin" class="icon-xs"></i> {{ tenancy.rental_property.address }}</p>
                    <p style="color: var(--gray-500); font-size: 0.875rem;">
                        {% if user.is_landlord %}
                        Tenant: {{ tenancy.tenant.get_full_name }}
                        {% else %}
                        Landlord: {{ tenancy.landlord.get_full_name }}
                        {% endif %}
                    </p>
                    <div class="rent" style="margin-top: 0.5rem;">
                        &#8358;{{ tenancy.rental_property.rent_amount|floatformat:"0"|intcomma }}
                        <span>/ {{ tenancy.rental_property.get_rent_period_display }}</span>
                    </div>
                    {% if tenancy.days_remaining is not None %}
                    <p
                        style="font-size: 0.8rem; margin-top: 0.5rem; color: {% if tenancy.days_remaining < 30 %}var(--danger){% elif tenancy.days_remaining < 90 %}var(--warning){% else %}var(--gray-500){% endif %};">
                        {{ tenancy.days_remaining }} days remaining
                    </p>
                    {% endif %}
                </div>
            </a>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-state">
            <div class="empty-state-icon"><i data-lucide="key-round" class="icon-md"></i></div>
            <h3>No Active Tenancies</h3>
            <p>{% if user.is_landlord %}Accept tenant applications to create tenancies.{% else %}Apply for properties on
                the marketplace to get started.{% endif %}</p>
            {% if user.is_tenant %}
            <a href="{% url 'marketplace_list' %}" class="btn btn-primary" style="margin-top: 1rem;">Browse
                Marketplace</a>
            {% endif %}
        </div>
        {% endif %}
    </div>
</section>
{% endblock %}